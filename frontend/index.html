<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Personal Finance Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="main.js" type="module" defer></script>
</head>

<body data-api-base="http://localhost:8000">
  <div class="app">
    <header class="app-header">
      <div>
        <h1>Personal Finance Manager</h1>
        <p>Model multiple scenarios and compare net worth / liquidity trends.</p>
      </div>
      <div class="status" id="status-banner"></div>
    </header>

    <div class="top-tabs-container">
      <button id="tab-plan" class="top-tab active" type="button">Plan</button>
      <button id="tab-track" class="top-tab" type="button">Track</button>
    </div>

    <main class="app-grid" id="plan-view">
      <section class="panel span-2" data-panel-id="plan">
        <h2>Plan Management</h2>

        <div class="plan-card" id="plan-loader">
          <h3>Plan Loading</h3>
          <label for="saved-plans">Saved Plans</label>
          <div class="plan-select-row">
            <select id="saved-plans"></select>
          </div>
          <div class="plan-loader-actions">
            <button id="load-plan-btn" class="secondary-btn" type="button">Load Plan</button>
            <button id="delete-plan-btn" class="secondary-btn" type="button">Delete Plan</button>
          </div>
          <button id="add-plan-btn" class="primary-btn" type="button">Add New Plan</button>
        </div>

        <div class="plan-card" id="simulation-box">
          <h3>Simulation & Plotting</h3>
          <p class="plan-note">Run the current plan to update charts and tables.</p>
          <div class="simulation-settings">
            <label for="freq">Granularity</label>
            <select id="freq"></select>
          </div>
          <div class="simulation-controls">
            <button id="run-simulation-btn" class="primary-btn" type="button">Simulate &amp; Plot</button>
            <button id="clear-scenarios" class="secondary-btn" type="button">Clear Results</button>
          </div>
          <div class="scenario-summary">
            <h4>Plotted Scenarios</h4>
            <p id="scenario-list">None yet</p>
          </div>
        </div>
      </section>

      <section class="panel span-2 is-hidden" data-panel-id="plan-basics" id="plan-editor-panel" hidden>
        <div class="plan-editor-header">
          <h2>Plan Basics &amp; Actions</h2>
          <div class="plan-editor-actions">
            <button id="save-plan-btn" class="secondary-btn" type="button">Save Current Plan</button>
            <button id="save-new-plan-btn" class="secondary-btn" type="button">Save As New Plan</button>
            <button id="save-layout-btn" class="secondary-btn" type="button">Save Layout</button>
          </div>
        </div>
        <div class="form-grid">
          <label for="plan-name">Scenario Name</label>
          <input id="plan-name" type="text" />

          <label for="plan-start-year">Start Year</label>
          <input id="plan-start-year" type="number" min="1900" max="2100" />

          <label for="plan-years">Duration (years)</label>
          <input id="plan-years" type="number" min="1" max="40" />

          <label for="tax-rate">Tax Rate (%)</label>
          <input id="tax-rate" type="number" min="0" max="60" step="0.5" />

        </div>
      </section>

      <section class="panel" data-panel-id="accounts">
        <div class="panel-header">
          <h2>Accounts / Assets / Debts</h2>
          <button id="add-account-row" class="secondary-btn" type="button">Add Row</button>
        </div>
        <div id="accounts-table" class="table-wrapper"></div>
      </section>

      <section class="panel" data-panel-id="income">
        <div class="panel-header">
          <h2>Income Streams</h2>
          <button id="add-income-row" class="secondary-btn" type="button">Add Row</button>
        </div>
        <div id="income-table" class="table-wrapper"></div>
      </section>

      <section class="panel" data-panel-id="spending">
        <div class="panel-header">
          <h2>Expense Streams</h2>
          <button id="add-spending-row" class="secondary-btn" type="button">Add Row</button>
        </div>
        <div class="living-inflation-control">
          <label for="living-inflation-rate">Living Cost Inflation Rate (%)</label>
          <input id="living-inflation-rate" type="number" min="0" step="0.1" value="0" />
        </div>
        <div id="spending-table" class="table-wrapper"></div>
      </section>

      <section class="panel span-2" data-panel-id="networth">
        <h2>Net Worth</h2>
        <div class="chart-container">
          <canvas id="networth-chart"></canvas>
        </div>
      </section>

      <section class="panel span-2" data-panel-id="liquid">
        <h2>Liquid Assets</h2>
        <div class="chart-container">
          <canvas id="liquid-chart"></canvas>
        </div>
      </section>

      <section class="panel span-2" data-panel-id="aggregate">
        <h2>Aggregated Data</h2>
        <div id="aggregate-table" class="aggregate-grid"></div>
      </section>
    </main>

    <main class="app-grid" id="track-view" style="display:none;">
      <section class="panel span-2" data-panel-id="tracker">
        <h2>Income / Expense Tracking</h2>
        
        <div class="plan-card" id="account-selector">
          <h3>Account Management</h3>
          <label for="tracked-accounts">Select Account</label>
          <div class="plan-select-row">
            <select id="tracked-accounts"></select>
          </div>
          <div class="plan-loader-actions">
            <button id="load-account-btn" class="secondary-btn" type="button">Load Account</button>
            <button id="delete-account-btn" class="secondary-btn" type="button">Delete Account</button>
          </div>
          <button id="add-account-btn" class="primary-btn" type="button">Create New Account</button>
        </div>

        <div class="plan-card" id="new-account-form" style="display:none;">
          <h3>Create New Account</h3>
          <div style="display:flex; flex-direction:column; gap:1rem;">
            <div style="display:flex; flex-direction:column; gap:0.5rem;">
              <label for="new-account-bank" style="font-size:0.85rem; text-transform:uppercase; letter-spacing:0.05em; color:var(--muted);">Bank</label>
              <select id="new-account-bank" style="width:100%; padding:0.4rem 0.5rem; border-radius:0.5rem; border:1px solid var(--panel-border); background:#12141a; color:var(--text);">
                <option value="">-- Select Bank --</option>
                <option value="chase">Chase</option>
                <option value="citi">Citi</option>
                <option value="bofa">Bank of America</option>
                <option value="wellsfargo">Wells Fargo</option>
                <option value="amex">American Express</option>
                <option value="discover">Discover</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div style="display:flex; flex-direction:column; gap:0.5rem;">
              <label for="new-account-type" style="font-size:0.85rem; text-transform:uppercase; letter-spacing:0.05em; color:var(--muted);">Account Type</label>
              <select id="new-account-type" style="width:100%; padding:0.4rem 0.5rem; border-radius:0.5rem; border:1px solid var(--panel-border); background:#12141a; color:var(--text);">
                <option value="">-- Select Type --</option>
                <option value="checking">Checking (Spending)</option>
                <option value="savings">Savings (Cash Flow)</option>
                <option value="investment">Investment (Portfolio)</option>
                <option value="loan">Loan (Debt)</option>
                <option value="credit">Credit Card (Debt)</option>
                <option value="income">Income Source</option>
              </select>
            </div>

            <div style="display:flex; flex-direction:column; gap:0.5rem;">
              <label for="new-account-name" style="font-size:0.85rem; text-transform:uppercase; letter-spacing:0.05em; color:var(--muted);">Account Name</label>
              <input id="new-account-name" type="text" placeholder="e.g., Chase Checking, Citi Costco" style="width:100%; padding:0.4rem 0.5rem; border-radius:0.5rem; border:1px solid var(--panel-border); background:#12141a; color:var(--text);" />
            </div>
          </div>
          <div class="plan-loader-actions" style="margin-top:1rem;">
            <button id="save-account-btn" class="primary-btn" type="button">Create Account</button>
            <button id="cancel-account-btn" class="secondary-btn" type="button">Cancel</button>
          </div>
        </div>

        <div class="plan-card" id="import-card">
          <h3>Import Transactions</h3>
          <p class="plan-note">Choose or create an account first, then import a CSV file.</p>
          <div id="drop-zone" class="drop-zone">
            <p>Drag &amp; drop CSV files here or <label for="file-input" class="link-btn">browse</label></p>
            <input id="file-input" type="file" accept=".csv" style="display:none" />
          </div>
          <div id="import-result" class="import-result"></div>
        </div>
        <div class="plan-card" id="summary-card">
          <h3>Spending Summary</h3>
          <p class="plan-note">Show spending totals (uses negative amounts) by month or year.</p>
          <div style="display:flex; gap:0.5rem; align-items:center; margin-top:0.5rem;">
            <label for="summary-period" style="min-width:70px;">Period</label>
            <select id="summary-period" style="padding:0.35rem; border-radius:0.4rem;">
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
            <select id="summary-month" style="padding:0.35rem; border-radius:0.4rem;">
              <option value="1">Jan</option>
              <option value="2">Feb</option>
              <option value="3">Mar</option>
              <option value="4">Apr</option>
              <option value="5">May</option>
              <option value="6">Jun</option>
              <option value="7">Jul</option>
              <option value="8">Aug</option>
              <option value="9">Sep</option>
              <option value="10">Oct</option>
              <option value="11">Nov</option>
              <option value="12">Dec</option>
            </select>
            <select id="summary-year" style="padding:0.35rem; border-radius:0.4rem; min-width:100px;"></select>
            <button id="summary-run" class="primary-btn" type="button">Show</button>
          </div>
          <div id="summary-result" style="margin-top:0.75rem;"></div>
        </div>

        <div class="panel-header">
          <h3>Recent Transactions</h3>
        </div>
        <div id="transactions-table" class="table-wrapper"></div>
      </section>
    </main>
  </div>
</body>

</html>
